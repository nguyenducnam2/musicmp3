<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{client/layout.html}">
    <head>
        <style>
            .main {
                position: relative;
                height: 100%;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                background: linear-gradient(to right, #5d6d7e, #566573);
            }
            .main button {
                padding: 10px 12px;
                margin: 0 10px;
            }
            .main #logo {
                position: absolute;
                top: 10px;
                left: 30px;
                font-size: 25px;
                color: #ccc;
            }
            .main #logo i {
                margin-right: 15px;
            }

            /* left & right part */
            .right,
            .left {
                position: relative;
                height: 100%;
                width: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }

            /* song image */
            .left img {
                height: 300px;
                width: 80%;
                border-radius: 15px;
                box-shadow: 1px 0px 20px 12px rgba(240, 240, 240, 0.2);
            }

            /* both range slider part */
            input[type="range"] {
                -webkit-appearance: none;
                width: 50%;
                outline: none;
                height: 2px;
                margin: 0 15px;
            }
            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                height: 20px;
                width: 20px;
                background: #ff8a65;
                border-radius: 50%;
                cursor: pointer;
            }
            .right input[type="range"] {
                width: 40%;
            }

            /* volume part */
            .left .volume {
                position: absolute;
                bottom: 10%;
                left: 0;
                width: 100%;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #fff;
            }
            .left .volume p {
                font-size: 15px;
            }
            .left .volume i {
                cursor: pointer;
                padding: 8px 12px;
                background: #ff8a65;
            }
            .left .volume i:hover {
                background: rgba(245, 245, 245, 0.1);
            }
            .volume #volume_show {
                padding: 8px 12px;
                margin: 0 5px 0 0;
                background: rgba(245, 245, 245, 0.1);
            }

            /* right part */
            .right .middle {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .right .middle button {
                border: none;
                height: 70px;
                width: 70px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                outline: none;
                transition: 0.5s;
                background: rgba(255, 255, 255, 0.1);
            }
            .right #title {
                position: absolute;
                top: 60px;
                left: 50%;
                transform: translateX(-50%);
                text-transform: capitalize;
                color: #fff;
                font-size: 35px;
            }
            .right #artist {
                position: absolute;
                top: 110px;
                left: 50%;
                transform: translateX(-50%);
                text-transform: capitalize;
                color: #fff;
                font-size: 18px;
            }
            .right .duration {
                position: absolute;
                bottom: 20%;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 20px;
                margin-top: 40px;
            }
            .right .duration p {
                color: #fff;
                font-size: 15px;
                margin-left: 20px;
            }
            .right #auto {
                font-size: 18px;
                cursor: pointer;
                margin-top: 45px;
                border: none;
                padding: 10px 14px;
                color: #fff;
                background: rgba(255, 255, 255, 0.2);
                outline: none;
                border-radius: 10px;
            }
            .right #auto i {
                margin-left: 8px;
            }
            #play {
                background: #ff8a65;
            }
            .right button:hover {
                background: #ff8a65;
            }
            .right i:before {
                color: #fff;
                font-size: 20px;
            }

            .right .show_song_no {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 30px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 8px 12px;
                color: #fff;
                border-radius: 5px;
                /* background: rgba(255, 255, 255, 0.2); */
                margin: 1px 2px;
            }
            .right .show_song_no p:nth-child(2) {

            }
        </style>
    </head>
    <body>
        <div layout:fragment="content" id="content-page" class="content-page">
            <div th:if="${mess} != null" class="alert btn-outline-primary" role="alert">
                <div th:if="${mess}=='Successfully'" class="iq-alert-icon">
                    <i class="ri-pencil-line"></i>
                </div>
                <div th:if="${mess}=='Failed'" class="iq-alert-icon">
                    <i class="ri-error-warning-line"></i>
                </div>
                <div class="iq-alert-text" th:text="${mess}">A simple <b>light</b> alertâ€”check it out!</div>
                <button type="button" class="close text-muted" data-dismiss="alert" aria-label="Close">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="iq-card" >
<!--                            <div class="iq-card-header d-flex justify-content-between" th:if="${playlistname!=null}">
                                <div class="iq-header-title">
                                    <h4 class="card-title" th:text="${playlistname}"></h4>
                                </div>
                            </div>-->
                            <div class="iq-card-body" style="height: 550px;">
<!--                                   <div class="row">
                                        <div class="col-lg-4">
                                            <img style="width: 200px;height: 250px;" th:src="@{'/webdata/user/'+${song.image}}" class="img-fluid w-100"  alt="">
                                        </div>
                                        <div class="col-lg-8">
                                            <div class="d-flex align-items-top justify-content-between iq-music-play-detail">
                                                <div class="music-detail">
                                                    <h3 th:text="${song.name}"><i class="las la-headphones"> Views</h3>
                                                    
                                                    <p class="mb-0"><p class="las la-headphones" th:text="'    '+${song.view}">   </p>
                                                    <div class="d-flex align-items-center">                                       
                                                         <a href="javascript:void(0);" class="btn btn-primary iq-play mr-2">Play music</a> 
                                                        <audio controls loop class="audiplay" nodownload style="width: 100%;">
                                                            <source th:src="@{'/webdata/audio/'+${song.media}}"/>
                                                        </audio> 
                                                    </div>
                                                </div>
                                                <div class="music-right">
                                                    <div class="d-flex align-items-center">
                                                        <div class="iq-circle mr-2 share"><a href="javascript:void();"><i class="las la-share-alt-square text-primary"></i></a></div>
                                                        <div class="iq-circle mr-2"><a href="javascript:void();"><i class="ri-heart-fill  text-primary"></i></a></div>                 
                                                        <div class="iq-circle">
                                                            <a href="javascript:void();"><i class="las la-download text-primary"></i></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> 
                                    </div> -->


                                <div style="font-size: larger;" id="cart"></div>
                                <div class="main">
                                    <p id="logo"><i class="fa fa-music"></i></p>
                                    <!--- left part --->
                                    <div class="left">
                                        <!--- song img --->
                                        <img id="track_image">
                                        <div class="volume">
                                            <p id="volume_show">90</p>
                                            <i class="fa fa-volume-up" aria-hidden="true" onclick="mute_sound()" id="volume_icon"></i>
                                            <input type="range" min="0" max="100" value="90" onchange="volume_change()" id="volume">  
                                        </div>
                                    </div>
                                    <!--- right part --->
                                    <div class="right">
                                     
                                        <h3 id="title">title.mp3</h3>
                                        
                                        <!--- middle part --->
                                        <div class="middle">
                                            <button onclick="previous_song()" id="pre"><i class="fa fa-step-backward" aria-hidden="true"></i></button>
<!--                                             <audio controls loop class="audiplay" nodownload style="width: 100%;">
                                                            <source th:src="@{'/webdata/audio/'+${song.media}}"/>
                                                        </audio> -->
                                            <button onclick="justplay()" id="play"><i class="fa fa-play" aria-hidden="true"></i></button>

                                            <button onclick="next_song()" id="next"><i class="fa fa-step-forward" aria-hidden="true"></i></button>
                                        </div>
                                        <!--- song duration part --->
                                        <div class="duration">
                                            <span style="color: wheat;" id="current"></span>
                                            <input type="range" min="0" max="100" value="0" id="duration_slider" onchange="change_duration()">
                                            <span style="color: wheat;" id="time"></span>
                                        </div>
                                        <button id="auto" onclick="autoplay_switch()">Auto play <i class="fa fa-circle-o-notch" aria-hidden="true"></i></button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                                        

                <div class="col-lg-12">
                    <div class="iq-card">
                        <div class="iq-card-body">
                            <ul class="nav nav-tabs" id="myTab-1" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">All Songs</a>
                                </li>
                                
                                
<!--                                <li class="nav-item">
                                    <a class="nav-link" id="comment-tab" data-toggle="tab" href="#comment" role="tab" aria-controls="comment" aria-selected="false">Comments</a>
                                </li>-->
                            </ul>
                            <div class="tab-content" id="myTabContent-2">
                                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                    <ul id="myListSong" class="list-unstyled iq-music-slide mb-0">
                                        <!--          <li class="mb-3">
                                                       <div class="d-flex justify-content-between align-items-center row">
                                                           <div class="media align-items-center col-10 col-md-5">
                                                               <div class="iq-realese-song ">
                                                                   <a th:href="@{/song/{id}(id=${item.id})}"><img th:src="@{'/webdata/album/'+${item.album.image}}" class="img-border-radius avatar-60 img-fluid" alt=""></a>
                                                               </div>
                                                               <div class="media-body ml-3">
                                                                   <p class="mb-0" th:text="${item.name}"></p>
                                                                   <small th:text="${item.artist.name}"></small>
                                                               </div>
                                                           </div>
                                                           <p class="mb-0 col-md-2 col-md-2 iq-music-time">
                                                           <p class="mb-0 col-2 col-md-2 iq-music-play"><a th:href="@{/song/{id}(id=${item.id})}"><i class="las la-play-circle font-size-32"></i></a></p>
                                                           <div class="iq-card-header-toolbar iq-music-drop d-flex align-items-center col-2 col-md-1">
                                                               <div class="dropdown">
                                                                   <span class="dropdown-toggle text-primary" id="dropdownMenuButton2" data-toggle="dropdown" aria-expanded="false" role="button">
                                                                       <i class="ri-more-2-fill text-primary"></i>
                                                                   </span>
                                                                   <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton2" style="">
                                                                       <a class="dropdown-item" href="#"><i class="ri-eye-fill mr-2"></i>View</a>
                                                                       <a class="dropdown-item" href="#"><i class="ri-delete-bin-6-fill mr-2"></i>Delete</a>
                                                                       <a class="dropdown-item" href="#"><i class="ri-file-download-fill mr-2"></i>Download</a>
                                                                   </div>
                                                               </div>
                                                           </div>
                                                       </div>
                                                   </li> -->
                                    </ul>
                                </div>
                                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                    <textarea id="lyric" disabled style="font-weight: bolder;background-color: white;font-family: unset;" class="form-control" rows="8"></textarea>
                                </div>
                                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                                    <p id="load_list"></p>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        



            <div th:if="${session.user ==null}" id="myModal-login" class="modal fade" role="dialog">

                <!--Modal-->
                <div class="modal-dialog">

                    <!--Modal Content-->
                    <div class="modal-content">
                        <section class="sign-in-page">
                            <div class="sign-user_card ">
                                <div class="d-flex justify-content-center">
                                    <div class="sign-user_logo">
                                        <a th:href="@{/}">
                                            <img th:src="@{/admintemplate/images/logo.png}" class=" img-fluid" alt="Logo">
                                        </a>
                                    </div>
                                </div>
                                <div class="sign-in-page-data">
                                    <div class="sign-in-from w-100 pt-5 m-auto">
                                        <h1 class="mb-3 text-center">Log in Muzik</h1>
                                        <div th:if="${param.error}" class="alert-warning">
                                            <h4>Invalid username and password.</h4>
                                        </div>
                                        <div th:if="${param.logout}" class="alert-heading">
                                            <h4>You have been logged out.</h4>
                                        </div>
                                        <form class="mt-4" th:action="@{/user-login-process}" method="post">
                                            <div class="form-group">
                                                <label for="exampleInputEmail2">Username</label>
                                                <input class="form-control mb-0" name="username" id="exampleInputEmail2" placeholder="Enter username" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputPassword2">Password</label>
                                                <input type="password" class="form-control mb-0" name="password" id="exampleInputPassword2" placeholder="Password" required>
                                            </div>
                                            <div class="sign-info">
                                                <button type="submit" class="btn btn-primary mb-2">Log in</button>
                                                <span class="dark-color d-block line-height-2">Don't have an account? <a href="sign-up.html">Sign up</a></span>
                                            </div>
                                            <div class="d-inline-block w-100">
                                                <div class="custom-control custom-checkbox d-inline-block mt-2 pt-1">
                                                    <input type="checkbox" class="custom-control-input" id="customCheck1">
                                                    <label class="custom-control-label" for="customCheck1">Remember Me</label>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="d-flex justify-content-center links">
                                        Don't have an account? <a th:href="@{/register}" class="ml-2">Sign Up</a>
                                    </div>
                                    <div class="d-flex justify-content-center links">
                                        <a th:href="@{/resetPassword}">Forgot your password?</a>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>


            <input type="hidden" id="songId" th:value="${song.id}"/>
            <input type="hidden" th:if="${session.user == null}" id="accountId" value="-1"/> 
        <input type="hidden" th:if="${session.user != null}" id="accountId" th:value="${session.user.id}"/> 


            <script th:inline="javascript">
                let previous = document.querySelector('#pre');
                let play = document.querySelector('#play');
                let next = document.querySelector('#next');
                let title = document.querySelector('#title');
                let recent_volume = document.querySelector('#volume');
                let volume_show = document.querySelector('#volume_show');
                let slider = document.querySelector('#duration_slider');
                let show_duration = document.querySelector('#show_duration');
                let track_image = document.querySelector('#track_image');
                let auto_play = document.querySelector('#auto');
                let present = document.querySelector('#present');
                let total = document.querySelector('#total');
                let time = document.querySelector('#time');
                let current = document.querySelector('#current');
                let songId = document.querySelector('#songId');
                let name = document.querySelector('#name');
//                let playlistId99 = document.querySelector('#playlistId99');
                let myList = document.querySelector('#myList');
                let myListPl = document.querySelector('#myListPl');
                let myListSong = document.querySelector('#myListSong');
                let accountId = document.querySelector('#accountId');

                let content = document.querySelector('#content');
                let myModal = document.querySelector('#myModal');

                let cart = document.querySelector('#cart');

                let timer;
                let autoplay = 0;

                let seconds;
                let minutes;

                let index_no = 0;
                let Playing_song = false;

                //create a audio Element
                let track = document.createElement('audio');
                //All songs list
                var All_song = /*[[${anotherlist}]]*/[];

                // Your document is loaded.

              
                function loadSongs(accountId) {
                        fetch(`http://localhost:8080/api/upload/findByAccountId?accountId=` + accountId.value, {method: "GET"})
                                .then((response) => response.json())
                                .then((response) => {
                                    var arr = response;
                                    myListSong.innerHTML = "";
                                    for (let i = 0; i < arr.length; i++) {
                                        if (arr[i].id == songId.value) {
                                            myListSong.innerHTML += "<li style='background-color:wheat;' class='mb-3'><div class='d-flex justify-content-between align-items-center row'><div class='media align-items-center col-10 col-md-5'><div class='iq-realese-song '><a href='http://localhost:8080/user/upload/" + arr[i].id + "'><img src='http://localhost:8080/webdata/user/" + arr[i].image + "' class='img-border-radius avatar-60 img-fluid' alt=''></a></div><div class='media-body ml-3'><p style='font-weight:bolder;' class='mb-0'>" + arr[i].name + "</p></div></div><p class='mb-0 col-md-2 col-md-2 iq-music-time'><div data-icon='&#xe003;' class='icon'>  "+arr[i].view+"</div></p><p class='mb-0 col-2 col-md-2 iq-music-play'><a href='http://localhost:8080/song/upload/" + arr[i].id + "'><i class='las la-pause-circle font-size-32' aria-hidden='true'></i></a></p></div></li>";
                                        } else {
                                            myListSong.innerHTML += "<li class='mb-3'><div class='d-flex justify-content-between align-items-center row'><div class='media align-items-center col-10 col-md-5'><div class='iq-realese-song '><a href='http://localhost:8080/user/upload/" + arr[i].id + "'><img src='http://localhost:8080/webdata/user/" + arr[i].image + "' class='img-border-radius avatar-60 img-fluid' alt=''></a></div><div class='media-body ml-3'><p class='mb-0'>" + arr[i].name + "</p></div></div><p class='mb-0 col-md-2 col-md-2 iq-music-time'><div data-icon='&#xe003;' class='icon'>  "+arr[i].view+"</div></p><p class='mb-0 col-2 col-md-2 iq-music-play'><a href='http://localhost:8080/song/upload/" + arr[i].id + "'><i class='las la-play-circle font-size-32'></i></a></p></div></li>";
                                        }
                                    }


                                });
                            } 
           function load_track(index_no) {
                    clearInterval(timer);
                    reset_slider();
                    track.src = "http://localhost:8080/webdata/audio/" + All_song[index_no].media;
                    title.innerHTML = All_song[index_no].name;
                    
                    track_image.src = "http://localhost:8080/webdata/user/" + All_song[index_no].image;
                    songId.value = All_song[index_no].id;

                    track.load();
                    playsong();
                    loadSongs(accountId);


                    timer = setInterval(range_slider, 1000);
                    var i = setInterval(function () {
                        if (track.readyState > 0) {
                            minutes = parseInt(track.duration / 60, 10);
                            seconds = track.duration % 60;
                            // (Put the minutes and seconds in the display)
                            time.innerHTML = minutes + ":" + parseInt(seconds);
                            clearInterval(i);
                        }
                    }, 200);
                    total.innerHTML = All_song.length;
                    present.innerHTML = index_no + 1;
                }

                load_track(index_no);
                //mute sound function
                function mute_sound() {
                    track.volume = 0;
                    volume.value = 0;
                    volume_show.innerHTML = 0;
                }


                // checking.. the song is playing or not
                function justplay() {
                    if (Playing_song == false) {
                        playsong();

                    } else {
                        pausesong();
                    }
                }


                // reset song slider
                function reset_slider() {
                    slider.value = 0;
                }

                // play song
                function playsong() {
                    track.play();
                    Playing_song = true;
                    play.innerHTML = '<i class="fa fa-pause" aria-hidden="true"></i>';
                }

                //pause song
                function pausesong() {
                    track.pause();
                    Playing_song = false;
                    play.innerHTML = '<i class="fa fa-play" aria-hidden="true"></i>';
                }


                // next song
                function next_song() {
                    if (index_no < All_song.length - 1) {
                        index_no += 1;
                        load_track(index_no);
                        playsong();
                    } else {
                        index_no = 0;
                        load_track(index_no);
                        playsong();

                    }
                }


                // previous song
                function previous_song() {
                    if (index_no > 0) {
                        index_no -= 1;
                        load_track(index_no);
                        playsong();

                    } else {
                        index_no = All_song.length;
                        load_track(index_no);
                        playsong();
                    }
                }


                // change volume
                function volume_change() {
                    volume_show.innerHTML = recent_volume.value;
                    track.volume = recent_volume.value / 100;
                }

                // change slider position 
                function change_duration() {
                    slider_position = track.duration * (slider.value / 100);
                    track.currentTime = slider_position;
                    current.innerHTML = Math.abs(minutes) + ":" + seconds;
                }

                // autoplay function
                function autoplay_switch() {
                    if (autoplay == 1) {
                        autoplay = 0;
                        auto_play.style.background = "rgba(255,255,255,0.2)";
                    } else {
                        autoplay = 1;
                        auto_play.style.background = "#FF8A65";
                    }
                }


                function range_slider() {
                    let position = 0;

                    // update slider position
                    if (!isNaN(track.duration)) {
                        position = track.currentTime * (100 / track.duration);
                        slider.value = position;

                        var i = setInterval(function () {
                            if (track.readyState > 0) {
                                minutes = parseInt(track.duration / 60, 10) - parseInt(track.currentTime / 60, 10) - parseInt(track.duration / 60, 10);
                                seconds = parseInt(track.currentTime) % 60;

                                // (Put the minutes and seconds in the display)
                                current.innerHTML = Math.abs(minutes) + ":" + seconds;
                                clearInterval(i);
                            }
                        }, 200);

                    }


                    // function will run when the song is over
                    if (track.ended) {
                        play.innerHTML = '<i class="fa fa-play" aria-hidden="true"></i>';
                        if (autoplay == 1) {
                            index_no += 1;
                            load_track(index_no);
                            playsong();
                        }
                    }
                }

             

          



            </script>


        </div>
    </body>
</html> 