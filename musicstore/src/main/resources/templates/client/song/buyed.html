<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
       layout:decorate="~{client/layout.html}">
    <body>
        <div layout:fragment="content" id="content-page" class="content-page">
            <div class="container-fluid" th:if="${session.user !=null}">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="iq-card">
                            <div class="iq-card-header d-flex justify-content-between">
                                <div class="iq-header-title">
                                    <h4 class="card-title">List Song Buyed</h4>
                                </div>
                            </div>
                            <div class="iq-card-body">
                                <div class="table-responsive">
                                    <table id="user-list-table" class="table table-striped table-bordered mt-4" role="grid" aria-describedby="user-list-page-info">
                                        <thead>
                                            <tr>
                                                <th>Poster</th>
                                                <th>Name</th>
                                                <th>Date</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="main">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <input type="hidden" th:if="${session.user != null}" id="accountId" th:value="${session.user.id}"/>
                <script>
                    let main = document.querySelector('#main');
                    let accountId = document.querySelector('#accountId');
                    function load() {
                        fetch(`http://localhost:8080/api/downloadallowed/findByAccountId?accountId=` + accountId.value, {method: "GET"})
                                .then((response) => response.json())
                                .then((response) => {
                                    if (response.length > 0) {
                                        main.innerHTML = "";
                                        for (let i = 0; i < response.length; i++) {
                                            main.innerHTML += "<tr><td class='text-center'><img src='http://localhost:8080/webdata/album/" + response[i].song.album.image + "' class='rounded img-fluid avatar-40'></td><td>" + response[i].song.name + "</td><td>" + new String(response[i].date).substring(0, 10) + "</td><td><a class='iq-icons-list' href='http://localhost:8080/webdata/audio/"+response[i].song.media+"' download><div data-icon=':' class='icon'></div><span>Download</span></a></td></tr>";
                                        }
                                    }else{
                                        main.innerHTML="";
                                        main.innerHTML="<p style='color:red'>List Empty</p>";
                                    }
                                })

                    }
                    load();
                </script>
            </div>



            <div  class="container-fluid" th:if="${session.user ==null}">
                <a th:href="@{/login}">You Must Login</a>
            </div>
            <input type="hidden" th:if="${session.user == null}" id="accountId" value="-1"/>
        </div>
    </body>
</html>
